<script type="text/javascript">
	function updateClock(){
		var currentTime = new Date ( );
		var currentDate = currentTime.getDate ( );
		var currentMonth = currentTime.getMonth ( ) + 1;
		var currentYear = currentTime.getFullYear ( );
		var currentHours = currentTime.getHours ( );
		var currentMinutes = currentTime.getMinutes ( );
		var currentSeconds = currentTime.getSeconds ( );

		currentDate = ( currentDate < 10 ? "0" : "" ) + currentDate;
		currentMonth = ( currentMonth < 10 ? "0" : "" ) + currentMonth;
		currentMinutes = ( currentMinutes < 10 ? "0" : "" ) + currentMinutes;
		currentSeconds = ( currentSeconds < 10 ? "0" : "" ) + currentSeconds;

		var currentTimeString = currentDate + "-" + currentMonth + "-" + currentYear + " " + currentHours + ":" + currentMinutes + ":" + currentSeconds;

		test_date_time = $.parseJSON(<%=get_test_time.dump.html_safe %>);
		test_finish_time = $.parseJSON(<%=get_test_finish_time.dump.html_safe %>);
		if (currentTimeString.match(test_date_time) || currentTimeString.match(test_finish_time))
		{
			window.location.reload();
		}
	}
</script>
<div class="container">
	<% if student_signed_in? %>
	<h1>welcome <%=current_student.first_name%></h1>
	<%end%>
	<div class="row">
		<div class="col-sm-12">
			<h1>Tests</h1>
			<div class="table-responsive">
				<table border="2"  class="table table-striped table-bordered table-hover" >
					<thead>

						<tr><th>No</th>
							<th>Subject</th>
							<th>Test Name</th>
							<th>Test Date and Time</th>
							<th>Total time</th>
							<th >No.of Questions</th>
							<th>Teacher Name</th>
							<th>Status</th>
						</tr> 
					</thead>
					<tbody>
						<%test_no = 0%>
						<% @tests.each do |test| %>
						<tr>
							<td ><%= test_no = test_no + 1 %></td>
							<td><%=test.standard_subject.subject.sub_name%></td>
							<td><%= test.test_name %></td>
							<td><%= test.test_datetime.strftime("%d-%m-%Y %l:%M %p") %> 
								<span class="badge"><%=days_remain(test)%></span></td>
								<td><span class="badge"><%= test.total_time %>:00 </span>  Minutes</td>
								<td>Questions <span class="badge"><%= test.no_of_questions %></span></td>
								<td><%= test.teacher.first_name %></td>
								<td><%= test_status(test) %></td>
								<% end %>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
		</div>


	<div class="row profile ">
		<div class="col-md-3">
			<div class="profile-sidebar">
				<!-- SIDEBAR USERPIC -->
				<div class="profile-userpic">
					<%= get_student_avatar %>
				</div>
				<!-- END SIDEBAR USERPIC -->
				<!-- SIDEBAR USER TITLE -->
				<div class="profile-usertitle">
					<div class="profile-usertitle-name">
						<%=current_student.first_name+" "+current_student.last_name%>
					</div>
					<div class="profile-usertitle-job">
						Student
					</div>
				</div>
				<!-- END SIDEBAR USER TITLE -->
				<!-- SIDEBAR BUTTONS -->
		
				<!-- END SIDEBAR BUTTONS -->
				<!-- SIDEBAR MENU -->
				<div class="profile-usermenu">
					<ul class="nav">
						<li class="active">
							<a href="#">
								<i class="glyphicon glyphicon-education"></i>
								No <%=current_student.enrollment_no%></a>
							</li>
							<li class="active">
								<a href="#">
									<i class="glyphicon glyphicon-calendar"></i>
									D.O.B <%=current_student.date_of_birth%></a>
								</a>
							</li>
							<li class="active">
								<a href="#">
									<i class="glyphicon glyphicon-globe"></i>
									<%=current_student.address+"("+current_student.city+")"%>
								</a>
							</li>
							<li class="dropdown active">
								<a class="dropdown-toggle" data-toggle="dropdown" href="#">
									<i class="glyphicon glyphicon-bell"></i>
									Up coming Tests  <span class="badge"><%=@upcoming_tests.count%></span>
								</a>
								<!-- /.dropdown -->
								<ul class="dropdown-menu dropdown-alerts">
									<% @upcoming_tests.each do |test| %>
									<li>
										<a href="#">
											<div>
												<%= test.test_name%>  
												<span class="pull-right text-muted ">
													<i class="glyphicon glyphicon-calendar"></i> 
													<%=days_remain(test)%>
												</span>
											</div>
										</a>
									</li>
									<% end %>

								</ul>    
								<!-- /.dropdown -->
							</li>
						</ul>
					</div>
					<!-- END MENU -->
				</div>
			</div>
			<div class="col-md-9">

				<div class="profile-content">	
					<div class="row">
						<div class="panel panel-default"> 
							<div class="panel-heading">
								<h3 class="panel-title"> <i class="glyphicon glyphicon-equalizer"></i> Performance Chart</h3>
							</div>  	   
							<div class="panel-body">

								<div class="col-md-4">
									<div class="thumbnail">
										<%=total_test_chart%>
										<div class="caption"> 
											<button type="button" class="btn btn-success btn-sm btn-block" >
												Test Attendance
											</button>

										</div>
									</div>
								</div>
								<div class="col-md-8">
									<div class="thumbnail">
										<%=all_test_performance_chart%>
										<div class="caption">
											<button type="button" class="btn btn-success btn-sm btn-block" >											
												Overall All Test Performance 
											</button>

										</div>
									</div>
								</div>

							</div>			
						</div>
						<div class="row">
							<div class="panel panel-default">
								<!-- Default panel contents -->
								<div class="panel-heading"><i class="glyphicon glyphicon-stats"></i>  Test Information</div>

								<div class="panel-body">
									<p>All The Test Information </p>
									<p>Total Test Attempted </p>
									<p></p>
								</div>
								<ul class="nav nav-tabs">
									<li class="active"><a data-toggle="tab" href="#home">
										Attempted Test  <span class="badge"> <%=@complete_tests.count%></span>
									</a>
								</li>
								<li><a data-toggle="tab" href="#menu1">
									Not Attepmted Test <span class="badge"> <%=@not_attended_tests.count%></span>
								</a>
							</li>
							<li><a data-toggle="tab" href="#menu2">
								Upcoming Test <span class="badge"> <%=@upcoming_tests.count%></span>
							</a>
						</li>
					</ul>


					<div class="tab-content">
						<div id="home" class="tab-pane fade in active">
							<div class="table-responsive"><%c=0%>
								<table border="1"  class="table table-striped table-bordered table-hover">
									<thead>

										<tr><th>No</th>
											<th>Subject</th>
											<th>Test Name</th>
											<th>Test Date and Time</th>
											<th>Total time</th>
											<th >No.of Questions</th>
											<th>Teacher Name</th>
											<th>Status</th>
										</tr> 
									</thead>
									<tbody>
										<% @complete_tests.each do |test| %>
										<tr>
											<td ><%= c=c+1 %></td>
											<td><%=test.standard_subject.subject.sub_name%></td>
											<td><%= test.test_name %></td>
											<td><%= test.test_datetime.strftime("%d-%m-%Y %l:%M %p") %> 
												<span class="badge"><%=days_remain(test)%></span></td>
												<td><span class="badge"><%= test.total_time %>:00 </span>  Minutes</td>
												<td>Questions <span class="badge"><%= test.no_of_questions %></span></td>
												<td><%= test.teacher.first_name %></td>
												<td><%= link_to "Complete","#",class: "btn btn-success btn-xs".html_safe %></td>

											</tr>
											<% end %>
										</tbody>
									</table>
								</div>
							</div>
							<div id="menu1" class="tab-pane fade">
								<div class="table-responsive"><%c=0%>
									<table border="1"  class="table table-striped table-bordered table-hover">
										<thead>

											<tr><th>No</th>
												<th>Subject</th>
												<th>Test Name</th>
												<th>Test Date and Time</th>
												<th>Total time</th>
												<th >No.of Questions</th>
												<th>Teacher Name</th>
												<th>Status</th>
											</tr> 
										</thead>
										<tbody>
											<% @not_attended_tests.each do |test| %>
											<tr>
												<td ><%= c=c+1 %></td>
												<td><%=test.standard_subject.subject.sub_name%></td>
												<td><%= test.test_name %></td>
												<td><%= test.test_datetime.strftime("%d-%m-%Y %l:%M %p") %> 
													<span class="badge"><%=days_remain(test)%></span></td>
													<td><span class="badge"><%= test.total_time %>:00 </span>  Minutes</td>
													<td>Questions <span class="badge"><%= test.no_of_questions %></span></td>
													<td><%= test.teacher.first_name %></td>
													<td><%= link_to "Not Attended","#",class: "btn btn-warning btn-xs".html_safe %></td>

												</tr>
												<% end %>
											</tbody>
										</table>
									</div>
								</div>
								<div id="menu2" class="tab-pane fade">
									<div class="table-responsive"><%c=0%>
										<table border="1"  class="table table-striped table-bordered table-hover">
											<thead>

												<tr><th>No</th>
													<th>Subject</th>
													<th>Test Name</th>
													<th>Test Date and Time</th>
													<th>Total time</th>
													<th >No.of Questions</th>
													<th>Teacher Name</th>
													<th>Status</th>
												</tr> 
											</thead>
											<tbody>
												<% @upcoming_tests.each do |test| %>
												<tr>
													<td ><%= c=c+1 %></td>
													<td><%=test.standard_subject.subject.sub_name%></td>
													<td><%= test.test_name %></td>
													<td><%= test.test_datetime.strftime("%d-%m-%Y %l:%M %p") %> 
														<span class="badge"><%=days_remain(test)%></span></td>
														<td><span class="badge"><%= test.total_time %>:00 </span>  Minutes</td>
														<td>Questions <span class="badge"><%= test.no_of_questions %></span></td>
														<td><%= test.teacher.first_name %></td>
														<td><%= test_status(test) %></td>
													</tr>
													<% end %>
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>	
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>